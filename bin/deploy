#!/usr/bin/env php
<?php
declare(strict_types=1);

function getVersionArgument(): float
{
    global $argv;

    if (count($argv) < 2) {
        throw new RuntimeException('First argument "version" is missing');
    }

    return (float) $argv[1];
}

function changeVersionInMainPluginFile(float $newVersion): void
{
    $file = __DIR__ . '/../wp-pager.php';

    $content = file_get_contents($file);

    $content = preg_replace('/Version: [0-9\.]+/', 'Version: ' . $newVersion, $content);

    file_put_contents($file, $content);
}

function changeVersionInReadmeFile(float $newVersion): void
{
    $file = __DIR__ . '/../readme.txt';

    $content = file_get_contents($file);

    $content = preg_replace('/Stable tag: [0-9\.]+/', 'Stable tag: ' . $newVersion, $content);

    file_put_contents($file, $content);
}

$newVersion = getVersionArgument();

changeVersionInMainPluginFile($newVersion);
changeVersionInReadmeFile($newVersion);